<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, viewport-fit=cover">
    <title>$50 QuickGiveaway</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Ad SDK Script -->
    <script src='//libtl.com/sdk.js' data-zone='9980483' data-sdk='show_9980483'></script>
    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* ... (same CSS as before ‚Äì no changes needed) ... */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        * {
            font-family: 'Inter', sans-serif;
        }
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --accent-color: #f5576c;
            --success-color: #48bb78;
            --warning-color: #f6ad55;
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
            --tg-bg-primary: #667eea;
            --tg-bg-secondary: #764ba2;
        }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }
        body {
            color: var(--text-primary);
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.05" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,138.7C960,139,1056,117,1152,106.7C1248,96,1344,96,1392,96L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') no-repeat bottom;
            background-size: cover;
            pointer-events: none;
            z-index: 0;
        }
        .app-wrapper {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .container {
            position: relative;
            z-index: 1;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
            padding-bottom: calc(80px + var(--safe-area-inset-bottom));
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.25);
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn {
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        .btn-accent {
            background: var(--accent-gradient);
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn-accent:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 87, 108, 0.4);
        }
        .btn:disabled {
            background: #e2e8f0;
            color: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }
        .progress-bar {
            height: 28px;
            border-radius: 14px;
            background: #e2e8f0;
            overflow: hidden;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            transition: width 0.6s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .countdown {
            font-size: 1.8rem;
            font-weight: 800;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .winner-card {
            background: var(--accent-gradient);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(245, 87, 108, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .winner-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
        }
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .social-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 16px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }
        .social-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .social-card i {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            background: var(--primary-gradient);
            color: white;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            z-index: 1000;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        .notification.show {
            transform: translateX(0);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 999;
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 32px;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .tab-button {
            flex: 1;
            padding: 8px 4px;
            text-align: center;
            font-weight: 700;
            transition: all 0.3s ease;
            cursor: pointer;
            color: #4a5568;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .tab-button i {
            font-size: 1.4rem;
            margin-bottom: 2px;
        }
        .tab-button span {
            font-size: 0.7rem;
            line-height: 1;
        }
        .tab-button.active {
            color: #667eea;
        }
        .tab-button.active::after {
            content: '';
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--primary-gradient);
            border-radius: 2px;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            z-index: 100;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: var(--safe-area-inset-bottom);
        }
        .balance-display {
            background: var(--primary-gradient);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        .balance-amount {
            font-size: 2.5rem;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            position: absolute;
            animation: confetti-fall 3s linear forwards;
        }
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .shimmer-badge {
            background: var(--accent-gradient);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: shimmer 2s infinite;
        }
        input[type="text"] {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 14px;
            width: 100%;
            transition: all 0.3s ease;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .task-item {
            background: linear-gradient(135deg, #f6f8fb 0%, #ffffff 100%);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .task-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        .floating-icon {
            position: absolute;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .ad-loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .profile-loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 8px;
        }
        @supports (padding: max(0px)) {
            .container {
                padding-left: max(16px, env(safe-area-inset-left));
                padding-right: max(16px, env(safe-area-inset-right));
            }
        }
        .container {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }
        .container::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        .container {
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <!-- ... (same HTML structure as before ‚Äì no changes needed) ... -->
    <div class="app-wrapper">
        <div class="container">
            <i class="fas fa-gift floating-icon text-white text-6xl" style="top: 10%; left: 5%;"></i>
            <i class="fas fa-trophy floating-icon text-white text-4xl" style="top: 60%; right: 5%; animation-delay: 2s;"></i>
            <i class="fas fa-coins floating-icon text-white text-5xl" style="bottom: 20%; left: 10%; animation-delay: 4s;"></i>
            <header class="mb-6">
                <div class="glass-card p-5">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="relative">
                                <img id="userProfilePic" src="https://picsum.photos/seed/telegramuser/60/60.jpg" alt="Profile" class="w-14 h-14 rounded-full border-3 border-white shadow-lg">
                                <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-400 rounded-full border-2 border-white"></div>
                            </div>
                            <div class="ml-4">
                                <h2 id="userName" class="font-bold text-xl text-gray-800">
                                    Loading...
                                    <span class="profile-loading"></span>
                                </h2>
                                <div class="flex items-center mt-1">
                                    <i class="fas fa-coins text-yellow-500 mr-1"></i>
                                    <span class="text-sm font-semibold text-gray-600">Balance: $<span id="userBalance">0.00</span></span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                                <i class="fas fa-gift text-white text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <div id="home" class="tab-content active">
                <div class="glass-card p-6 mb-6 text-center relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="shimmer-badge inline-block mb-3">üéâ LIVE GIVEAWAY</div>
                        <h1 class="text-3xl font-black mb-3 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                            $50 QuickGiveaway
                        </h1>
                        <p class="text-gray-600 mb-4">Every 24 hours ‚Ä¢ One winner</p>
                        <div class="pulse">
                            <div class="countdown text-4xl" id="homeCountdown">24h 00m 00s</div>
                        </div>
                    </div>
                    <i class="fas fa-gift absolute -right-10 -top-10 text-white opacity-10 text-9xl"></i>
                </div>
                <div class="glass-card p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">
                            <i class="fas fa-play-circle text-purple-600 mr-2"></i>
                            Watch Ads <span id="adsWatchedCount">0</span> / 50 
                        </h3>
                        <span class="shimmer-badge">Required</span>
                    </div>
                    <div class="progress-bar mb-4">
                        <div class="progress-fill" id="adProgress" style="width: 0%">
                            <span id="adProgressText">0/50</span>
                        </div>
                    </div>
                    <button id="watchAdBtn" class="btn btn-primary w-full">
                        <i class="fas fa-play mr-2"></i> Watch Ad (0/50)
                    </button>
                </div>
                <button id="enterGiveawayBtn" class="btn btn-accent w-full text-lg py-4 font-bold" disabled>
                    <i class="fas fa-rocket mr-2"></i> Enter Giveaway
                </button>
            </div>
            <div id="tasks" class="tab-content">
                <div class="glass-card p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">
                        <i class="fas fa-clipboard-list text-purple-600 mr-2"></i>
                        Social Media Tasks
                    </h2>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <a href="https://t.me/EarnOnlineWithSufyan" target="_blank" class="social-card">
                            <i class="fab fa-telegram text-blue-500"></i>
                            <span class="text-sm font-bold text-gray-700">Telegram Channel</span>
                        </a>
                        <a href="https://t.me/quick_cash_announcement" target="_blank" class="social-card">
                            <i class="fas fa-users text-blue-600"></i>
                            <span class="text-sm font-bold text-gray-700">Telegram Group</span>
                        </a>
                        <a href="https://www.facebook.com/sufyanThePro" target="_blank" class="social-card">
                            <i class="fab fa-facebook text-blue-700"></i>
                            <span class="text-sm font-bold text-gray-700">Facebook</span>
                        </a>
                        <a href="https://www.youtube.com/@SufyanCircuit" target="_blank" class="social-card">
                            <i class="fab fa-youtube text-red-500"></i>
                            <span class="text-sm font-bold text-gray-700">YouTube</span>
                        </a>
                    </div>
                    <div class="text-center py-6">
                        <i class="fas fa-info-circle text-purple-600 text-3xl mb-3"></i>
                        <p class="text-gray-600 font-medium">Follow our social media channels to stay updated with the latest giveaways and announcements!</p>
                        <p class="text-sm text-gray-500 mt-2">Click on any card above to visit our social media pages</p>
                    </div>
                </div>
            </div>
            <div id="winners" class="tab-content">
                <div class="glass-card p-6">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-crown text-yellow-500 mr-2"></i>
                            Hall of Winners
                        </h2>
                    </div>
                    <div class="winner-card mb-6 relative">
                        <div class="relative z-10">
                            <i class="fas fa-trophy text-5xl text-white mb-3"></i>
                            <h3 class="text-xl font-bold text-white mb-2">üéä Latest Winner üéä</h3>
                            <p class="text-3xl font-black text-white" id="currentWinner">Rajesh Kumar</p>
                            <p class="text-white/90 mt-2">Won $50 ‚Ä¢ <span id="winnerDate">Today</span></p>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg mb-4 text-gray-800">Recent Winners</h3>
                        <div class="space-y-3" id="previousWinners">
                            <!-- populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
            <div id="withdraw" class="tab-content">
                <div class="glass-card p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">
                        <i class="fas fa-hand-holding-usd text-green-600 mr-2"></i>
                        Withdraw Funds
                    </h2>
                    <div class="balance-display mb-6">
                        <p class="text-white/90 text-sm mb-2">Available Balance</p>
                        <p class="balance-amount">$<span id="withdrawBalance">0.00</span></p>
                        <p class="text-white/80 text-xs mt-2">Minimum withdrawal: $10</p>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-wallet mr-1"></i> Binance Wallet Address
                        </label>
                        <input type="text" id="binanceAddress" placeholder="Enter your Binance wallet address" class="w-full">
                        <p class="text-xs text-gray-500 mt-2">Make sure the address is correct</p>
                    </div>
                    <button id="requestWithdrawBtn" class="btn btn-accent w-full mb-6 py-4 text-lg" disabled>
                        <i class="fas fa-paper-plane mr-2"></i> Request Withdrawal
                    </button>
                    <div>
                        <h3 class="font-bold text-lg mb-4 text-gray-800">Transaction History</h3>
                        <div id="withdrawalHistory" class="space-y-3">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-inbox text-4xl mb-2"></i>
                                <p>No transactions yet</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="glass-card rounded-none border-0 shadow-none">
                <div class="flex">
                    <div class="tab-button active" data-tab="home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </div>
                    <div class="tab-button" data-tab="tasks">
                        <i class="fas fa-tasks"></i>
                        <span>Tasks</span>
                    </div>
                    <div class="tab-button" data-tab="winners">
                        <i class="fas fa-trophy"></i>
                        <span>Winners</span>
                    </div>
                    <div class="tab-button" data-tab="withdraw">
                        <i class="fas fa-wallet"></i>
                        <span>Withdraw</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="notification" class="notification">
        <span id="notificationText">Notification message</span>
    </div>
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-white text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Success!</h3>
                <p id="confirmMessage" class="text-gray-600">Action completed successfully</p>
            </div>
            <button id="confirmBtn" class="btn btn-primary w-full">
                Got it!
            </button>
        </div>
    </div>
    <script>
        // App State
        const appState = {
            adsWatched: 0,
            isParticipating: false,
            balance: 0,
            userName: 'Telegram User',
            userPic: 'https://picsum.photos/seed/telegramuser/60/60.jpg',
            userId: null,
            withdrawalHistory: [],
            // giveawayEndTime is now computed dynamically ‚Äî not stored
            currentWinner: 'Rajesh Kumar',
            winnerDate: 'Today',
            previousWinners: [
                { name: 'Priya Sharma', date: 'Last 24h' },
                { name: 'Amit Patel', date: 'Previous 24h' },
                { name: 'Sneha Reddy', date: '2 cycles ago' },
                { name: 'Vikram Singh', date: '3 cycles ago' }
            ],
            adLoading: false,
            lastSavedDate: new Date().toDateString()
        };

        const GIVEAWAY_DURATION = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

        // Indian Names Pool
        const indianNames = [
            'Rajesh Kumar', 'Priya Sharma', 'Amit Patel', 'Sneha Reddy', 'Vikram Singh',
            'Anjali Gupta', 'Rahul Verma', 'Kavita Nair', 'Sanjay Mishra', 'Meera Joshi',
            'Arjun Kapoor', 'Pooja Desai', 'Rohit Sharma', 'Divya Agarwal', 'Vivek Menon',
            'Neha Chatterjee', 'Karan Singhania', 'Anita Iyer', 'Ravi Malhotra', 'Sonia Kapoor',
            'Ajay Kumar', 'Rashmi Verma', 'Manoj Sharma', 'Deepa Patel', 'Vikas Gupta',
            'Shweta Reddy', 'Alok Singh', 'Kavita Joshi', 'Rohit Kumar', 'Priya Nair',
            'Anil Sharma', 'Sunita Patel', 'Rajesh Verma', 'Anita Singh', 'Vikram Reddy',
            'Pooja Gupta', 'Amit Kumar', 'Meera Sharma', 'Rahul Patel', 'Divya Singh',
            'Sanjay Kumar', 'Neha Sharma', 'Arjun Singh', 'Kavita Patel', 'Rohit Verma'
        ];

        // Helper: Get next UTC-aligned giveaway end time (every 24h at 00:00 UTC)
        function getNextGiveawayEndTime() {
            const now = new Date();
            const next = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() + 1, 0, 0, 0));
            return next.getTime();
        }

        // Save user state (without giveawayEndTime)
        function saveUserState() {
            const userState = {
                adsWatched: appState.adsWatched,
                isParticipating: appState.isParticipating,
                lastSavedDate: new Date().toDateString(),
                balance: appState.balance,
                withdrawalHistory: appState.withdrawalHistory,
                currentWinner: appState.currentWinner,
                winnerDate: appState.winnerDate,
                previousWinners: appState.previousWinners
            };
            localStorage.setItem('userState', JSON.stringify(userState));
        }

        // Load user state with daily reset logic (but timer is now global)
        function loadUserState() {
            const savedState = localStorage.getItem('userState');
            const today = new Date().toDateString();
            if (savedState) {
                try {
                    const userState = JSON.parse(savedState);
                    if (userState.lastSavedDate !== today) {
                        // New day: reset progress
                        appState.adsWatched = 0;
                        appState.isParticipating = false;
                        appState.lastSavedDate = today;
                        showNotification('üåÖ Daily reset! New giveaway started!');
                    } else {
                        // Same day: restore state (except timer)
                        Object.assign(appState, {
                            adsWatched: userState.adsWatched || 0,
                            isParticipating: userState.isParticipating || false,
                            balance: userState.balance || 0,
                            withdrawalHistory: userState.withdrawalHistory || [],
                            currentWinner: userState.currentWinner || 'Rajesh Kumar',
                            winnerDate: userState.winnerDate || 'Today',
                            previousWinners: userState.previousWinners || appState.previousWinners,
                            lastSavedDate: userState.lastSavedDate || today
                        });
                    }
                } catch (e) {
                    console.error('Error loading user state:', e);
                    resetAppState();
                }
            } else {
                resetAppState();
            }
        }

        function resetAppState() {
            appState.adsWatched = 0;
            appState.isParticipating = false;
            appState.lastSavedDate = new Date().toDateString();
        }

        // Telegram App Init
        function initTelegramApp() {
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.expand();
                window.Telegram.WebApp.enableClosingConfirmation();
                window.Telegram.WebApp.setHeaderColor('#667eea');
                window.Telegram.WebApp.setBackgroundColor('#667eea');
                window.Telegram.WebApp.onEvent('viewportChanged', () => {
                    updateCountdown();
                });
                window.Telegram.WebApp.onEvent('mainButtonClicked', saveUserState);
                window.addEventListener('beforeunload', saveUserState);
                let user = window.Telegram.WebApp.initDataUnsafe?.user;
                if (!user && window.Telegram.WebApp.initData) {
                    try {
                        const params = new URLSearchParams(window.Telegram.WebApp.initData);
                        const userStr = params.get('user');
                        if (userStr) user = JSON.parse(decodeURIComponent(userStr));
                    } catch (e) {
                        console.error('Parse error:', e);
                    }
                }
                if (user) {
                    appState.userName = (user.first_name || '') + (user.last_name ? ' ' + user.last_name : '');
                    appState.userId = user.id;
                    appState.userPic = user.photo_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.id}`;
                    document.getElementById('userName').textContent = appState.userName;
                    document.getElementById('userProfilePic').src = appState.userPic;
                    localStorage.setItem('telegramUser', JSON.stringify(user));
                    setTimeout(() => showNotification(`üëã Welcome, ${appState.userName}!`), 1000);
                }
            } else {
                document.getElementById('userName').textContent = 'Test User';
                showNotification('‚ö†Ô∏è Running in test mode');
            }
        }

        // Countdown using global UTC-aligned end time
        function updateCountdown() {
            const now = Date.now();
            const giveawayEndTime = getNextGiveawayEndTime();
            const distance = giveawayEndTime - now;

            if (distance <= 0) {
                selectWinner();
                // No need to update giveawayEndTime ‚Äî it's always computed
                return;
            }

            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            document.getElementById('homeCountdown').textContent = `${hours}h ${minutes}m ${seconds}s`;
        }

        // Start countdown loop
        function startCountdown() {
            updateCountdown();
            let lastFrame = 0;
            const frame = (now) => {
                if (now - lastFrame >= 1000) {
                    updateCountdown();
                    lastFrame = now;
                }
                requestAnimationFrame(frame);
            };
            requestAnimationFrame(frame);
        }

        // Ad & UI Logic (unchanged)
        function showAd() {
            if (typeof show_9980483 !== 'function') {
                showNotification('‚ö†Ô∏è Ad service unavailable.');
                return;
            }
            if (appState.adLoading || appState.adsWatched >= 50) return;
            appState.adLoading = true;
            const btn = document.getElementById('watchAdBtn');
            const orig = btn.innerHTML;
            btn.innerHTML = '<span class="ad-loading"></span> Loading Ad...';
            btn.disabled = true;
            show_9980483().then(() => {
                appState.adsWatched++;
                updateAdProgress();
                saveUserState();
                showNotification('üé¨ Ad watched! Keep going!');
                if (appState.adsWatched === 50) {
                    document.getElementById('enterGiveawayBtn').disabled = false;
                    showNotification('üéâ You can now enter the giveaway!');
                }
            }).catch(err => {
                console.error('Ad error:', err);
                showNotification('‚ö†Ô∏è Ad failed. Try again.');
            }).finally(() => {
                appState.adLoading = false;
                btn.innerHTML = orig;
                btn.disabled = false;
            });
        }

        function updateAdProgress() {
            const pct = (appState.adsWatched / 50) * 100;
            document.getElementById('adProgress').style.width = `${pct}%`;
            document.getElementById('adProgressText').textContent = `${appState.adsWatched}/50`;
            document.getElementById('adsWatchedCount').textContent = appState.adsWatched;
            document.getElementById('watchAdBtn').innerHTML = `<i class="fas fa-play mr-2"></i> Watch Ad (${appState.adsWatched}/50)`;
        }

        function selectWinner() {
            appState.previousWinners.unshift({ name: appState.currentWinner, date: appState.winnerDate });
            appState.previousWinners = appState.previousWinners.slice(0, 4);
            appState.currentWinner = indianNames[Math.floor(Math.random() * indianNames.length)];
            appState.winnerDate = 'Today';
            if (appState.isParticipating && Math.random() < 0.1) {
                appState.balance += 50;
                updateBalanceDisplay();
                showNotification('üéä You won $50!');
                createConfetti();
            }
            appState.isParticipating = false;
            appState.adsWatched = 0;
            updateAdProgress();
            document.getElementById('enterGiveawayBtn').disabled = true;
            document.getElementById('enterGiveawayBtn').innerHTML = '<i class="fas fa-rocket mr-2"></i> Enter Giveaway';
            updateWinnersDisplay();
            saveUserState();
        }

        function updateWinnersDisplay() {
            document.getElementById('currentWinner').textContent = appState.currentWinner;
            document.getElementById('winnerDate').textContent = appState.winnerDate;
            const colors = ['from-yellow-400 to-orange-500', 'from-gray-400 to-gray-600', 'from-orange-600 to-red-600', 'from-blue-400 to-blue-600'];
            document.getElementById('previousWinners').innerHTML = appState.previousWinners.map((w, i) => `
                <div class="task-item">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gradient-to-br ${colors[i]} rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-medal text-white"></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-800">${w.name}</p>
                                <p class="text-xs text-gray-500">${w.date}</p>
                            </div>
                        </div>
                        <span class="text-green-600 font-bold">$50</span>
                    </div>
                </div>
            `).join('');
        }

        function updateBalanceDisplay() {
            const bal = appState.balance.toFixed(2);
            document.getElementById('userBalance').textContent = bal;
            document.getElementById('withdrawBalance').textContent = bal;
            document.getElementById('requestWithdrawBtn').disabled = appState.balance <= 0;
        }

        function updateWithdrawalHistory() {
            if (!appState.withdrawalHistory.length) {
                document.getElementById('withdrawalHistory').innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-2"></i>
                        <p>No transactions yet</p>
                    </div>`;
                return;
            }
            document.getElementById('withdrawalHistory').innerHTML = appState.withdrawalHistory.map(w => `
                <div class="task-item">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold text-gray-800">$${w.amount.toFixed(2)}</p>
                            <p class="text-xs text-gray-500">${w.date}</p>
                            <p class="text-xs text-gray-400 mt-1">${w.address.substring(0,10)}...${w.address.slice(-10)}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-bold ${
                            w.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'
                        }">${w.status === 'pending' ? '‚è≥ Pending' : '‚úÖ Completed'}</span>
                    </div>
                </div>
            `).join('');
        }

        function showNotification(msg) {
            const el = document.getElementById('notification');
            document.getElementById('notificationText').textContent = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        function showConfirmModal(msg, cb) {
            document.getElementById('confirmMessage').textContent = msg;
            const modal = document.getElementById('confirmModal');
            modal.classList.add('show');
            document.getElementById('confirmBtn').onclick = () => {
                modal.classList.remove('show');
                cb();
            };
        }

        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#fa709a', '#fee140'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const c = document.createElement('div');
                    c.className = 'confetti';
                    c.style.left = Math.random() * 100 + '%';
                    c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    document.body.appendChild(c);
                    setTimeout(() => c.remove(), 3000);
                }, i * 30);
            }
        }

        // Initialize
        function initApp() {
            loadUserState();
            initTelegramApp();
            updateAdProgress();
            updateBalanceDisplay();
            updateWinnersDisplay();
            updateWithdrawalHistory();
            if (appState.adsWatched >= 50 && !appState.isParticipating) {
                document.getElementById('enterGiveawayBtn').disabled = false;
            }
            if (appState.isParticipating) {
                document.getElementById('enterGiveawayBtn').disabled = true;
                document.getElementById('enterGiveawayBtn').innerHTML = '<i class="fas fa-check-circle mr-2"></i> You\'re in the giveaway!';
            }
            startCountdown();

            // Event listeners
            document.getElementById('watchAdBtn').addEventListener('click', showAd);
            document.getElementById('enterGiveawayBtn').addEventListener('click', () => {
                if (appState.adsWatched >= 50 && !appState.isParticipating) {
                    showConfirmModal("üéä You're now participating in the $50 Giveaway! Good luck!", () => {
                        appState.isParticipating = true;
                        saveUserState();
                        createConfetti();
                        showNotification('üöÄ Successfully entered the giveaway!');
                        document.getElementById('enterGiveawayBtn').disabled = true;
                        document.getElementById('enterGiveawayBtn').innerHTML = '<i class="fas fa-check-circle mr-2"></i> You\'re in the giveaway!';
                    });
                }
            });
            document.getElementById('requestWithdrawBtn').addEventListener('click', () => {
                const addr = document.getElementById('binanceAddress').value;
                if (!addr) return showNotification('‚ö†Ô∏è Enter Binance address');
                if (appState.balance <= 0) return showNotification('‚ö†Ô∏è No balance');
                showConfirmModal('üí∏ Withdrawal request received. Processed within 24 hours.', () => {
                    appState.withdrawalHistory.unshift({
                        id: Date.now(),
                        amount: appState.balance,
                        address: addr,
                        date: new Date().toLocaleDateString(),
                        status: 'pending'
                    });
                    appState.balance = 0;
                    updateBalanceDisplay();
                    updateWithdrawalHistory();
                    saveUserState();
                    document.getElementById('binanceAddress').value = '';
                    showNotification('‚úÖ Withdrawal submitted!');
                });
            });

            // Tab switching
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(btn.dataset.tab).classList.add('active');
                    document.querySelector('.container').scrollTop = 0;
                });
            });
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
